



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>Data Model - Balsam</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#data-model-and-rest-api" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Balsam" aria-label="Balsam" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Balsam
            </span>
            <span class="md-header-nav__topic">
              
                Data Model
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/balsam-alcf/balsam/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    balsam-alcf/balsam
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Balsam" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Balsam
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/balsam-alcf/balsam/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    balsam-alcf/balsam
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../contributing/" title="Contribution Guide" class="md-nav__link">
      Contribution Guide
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Data Model
      </label>
    
    <a href="./" title="Data Model" class="md-nav__link md-nav__link--active">
      Data Model
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-view-of-the-database" class="md-nav__link">
    High-level view of the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-rest-api" class="md-nav__link">
    The REST API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-api" class="md-nav__link">
    User API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#site" class="md-nav__link">
    Site
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-fields" class="md-nav__link">
    Model Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representation" class="md-nav__link">
    Representation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urls" class="md-nav__link">
    URLs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app" class="md-nav__link">
    App
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-fields_1" class="md-nav__link">
    Model Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representation_1" class="md-nav__link">
    Representation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urls_1" class="md-nav__link">
    URLs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job" class="md-nav__link">
    Job
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-fields_2" class="md-nav__link">
    Model Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_2" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representation_2" class="md-nav__link">
    Representation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urls_2" class="md-nav__link">
    URLs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../site-config/" title="Site Configuration" class="md-nav__link">
      Site Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../client/" title="The Python REST Client" class="md-nav__link">
      The Python REST Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../appdef/" title="Defining Applications" class="md-nav__link">
      Defining Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../jobsource/" title="JobSource and StatusUpdater" class="md-nav__link">
      JobSource and StatusUpdater
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../launcher/" title="Launcher" class="md-nav__link">
      Launcher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service/" title="Service modules" class="md-nav__link">
      Service modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../platform/" title="Platform Interfaces" class="md-nav__link">
      Platform Interfaces
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../todo/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ffn_balsam_interactive/" title="Launching Jobs from a Jupyter Notebook" class="md-nav__link">
      Launching Jobs from a Jupyter Notebook
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../LICENSE/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#high-level-view-of-the-database" class="md-nav__link">
    High-level view of the database
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-rest-api" class="md-nav__link">
    The REST API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-api" class="md-nav__link">
    User API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#site" class="md-nav__link">
    Site
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-fields" class="md-nav__link">
    Model Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representation" class="md-nav__link">
    Representation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urls" class="md-nav__link">
    URLs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app" class="md-nav__link">
    App
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-fields_1" class="md-nav__link">
    Model Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_1" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representation_1" class="md-nav__link">
    Representation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urls_1" class="md-nav__link">
    URLs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job" class="md-nav__link">
    Job
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model-fields_2" class="md-nav__link">
    Model Fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api_2" class="md-nav__link">
    API
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#representation_2" class="md-nav__link">
    Representation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#urls_2" class="md-nav__link">
    URLs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/balsam-alcf/balsam/edit/master/docs/development/data-model.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="data-model-and-rest-api">Data Model and REST API</h1>
<p><img alt="Database Schema" src="../../graphs/db.png" /></p>
<p>This graph shows the Django models, or database schema, of the Balsam
application. Each node is a table in the database, represented by one
of the model classes in the Django ORM.
Each arrow represents a ForeignKey 
(or <a href="https://docs.djangoproject.com/en/3.0/topics/db/examples/many_to_one/">many-to-one</a>)
relationship between two tables.</p>
<h2 id="high-level-view-of-the-database">High-level view of the database</h2>
<ol>
<li>
<p>A <code>User</code> represents a Balsam user account.  <strong>All</strong> items in the database
     are linked to a single owner, which is reflected in the connectivity of
     the graph. For example, to get all the jobs belonging to <code>current_user</code>,
     join the tables via <code>Job.objects.filter(app__site__user=current_user)</code></p>
</li>
<li>
<p>A <code>Site</code> is uniquely identified as a directory on some machine: <code>(machine
     hostname,  directory path)</code>. One user can own several Balsam sites
     located across one or several machines.  Each site is an <em>independent</em>
     endpoint where applications are registered, data is transferred in and
     out, and Job working directories are located. A Balsam service daemon, which is 
     <strong>authenticated</strong> to the REST API, is uniquely associated with a single <code>Site</code> and
     runs as the user on that system. If a user has multiple active Balsam Sites, then a separate
     service runs at each of them.  The authenticated daemon communicates with the central
     Balsam API to fetch jobs, orchestrate the workflow locally, and update the database state. </p>
</li>
<li>
<p>An <code>App</code> represents a runnable application at a particular Balsam Site.
     Every Balsam Site contains an <code>apps/</code> directory with Python modules
     containing <code>ApplicationDefinition</code> classes.  The set of
     <code>ApplicationDefinitions</code> determines the applications which may run at the
     Site.  An <code>App</code> instance in the data model is merely a reference to an
     <code>ApplicationDefinition</code> class, uniquely identified by the Site ID and
     class path. </p>
</li>
<li>
<p>A <code>Job</code> represents a single run of an <code>App</code> at a particular <code>Site</code>.  The
     <code>Job</code> contains both application-specific data (like command line
     arguments) and resource requirements (like number of MPI ranks per node)
     for the run. It is important to note that Job--&gt;App--&gt;Site are
     non-nullable relations, so a <code>Job</code> is always bound
     to run at a particular <code>Site</code>.  Therefore, the corresponding Balsam service
     daemon may begin staging-in data as soon as a <code>Job</code> becomes visible, as appropriate.</p>
</li>
<li>
<p>A <code>BatchJob</code> represents a job launch script and resource request submitted
     by the <code>Site</code> to the local workload manager or job Scheduler. Notice that
     the relation of <code>BatchJob</code> to <code>Site</code> is many-to-one, and that <code>Job</code> to
     <code>BatchJob</code> is many-to-one. That is, many <code>Jobs</code> run in a single
     <code>BatchJob</code>, and many <code>BatchJobs</code> are submitted at a <code>Site</code> over time.</p>
</li>
<li>
<p>The <code>Lock</code> is an internal model representing an active Balsam launcher
     session.  <code>Jobs</code> have a nullable relationship to <code>Lock</code>; when it is not
     null, the job is said to be <em>locked</em> by a launcher, and no other launcher
     should try running it.  The Balsam <strong>session API</strong> is used by launchers to
     acquire jobs concurrently and without race conditions.  Locks contain a
     heartbeat timestamp that must be periodically ticked to maintain the lock.</p>
</li>
<li>
<p>A <code>TransferItem</code> is created for each stage-in or stage-out task
      associated with a <code>Job</code>. This permits the transfer module of the Balsam
      service to group transfers according to the remote source or destination,
      and therefore batch small transfers efficiently. When all the stage-in <code>TransferItems</code>
      linked to a <code>Job</code> are finished, it is considered "staged-in" and moves ahead to
      preprocessing.</p>
</li>
<li>
<p>A <code>LogEvent</code> contains a <code>timestamp</code>, <code>from_state</code>, <code>to_state</code>, and <code>message</code> for each
   state transition linked to a <code>Job</code>.  The benefit of breaking a Job's state history out into
   a separate Table is that it becomes easy to query for aggregate throughput, etc... without
   having to first parse and accumulate timestamps nested inside a <code>Job</code> field.</p>
</li>
</ol>
<h2 id="the-rest-api">The REST API</h2>
<p>Refer to the interactive and detailed API documentation (URL query parameters, sample
request and response payloads) for every endpoint at the <code>/api/swagger/</code> endpoint:</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span> balsam/server
./dev/total-reset.sh
./manage.py runserver
<span class="c1"># Navigate to 127.0.0.1:8000/api/swagger in browser</span>
</code></pre></div>

<p><img alt="Swagger UI" src="../../graphs/swagger.png" /></p>
<p>The rest of this page gives a condensed overview of the API, with the aim of
explaining concepts rather than serving as a reference for actual development.</p>
<h2 id="user-api">User API</h2>
<p>The <code>User</code> model Extends Django's <a href="https://docs.djangoproject.com/en/3.0/ref/contrib/auth/">default User
model</a> via
<code>AbstractUser</code>. It contains fields like <code>username</code> and <code>email</code> but is loosely
coupled to the Authentication scheme.</p>
<p>Django REST Framework easily permits swapping Authentication backends or using multiple
authentication schemes.  For every view requiring authentication, 
a <code>user</code> object is available on the <code>request</code> instance, containing the pre-authenticated
User.</p>
<p>Generally, Balsam will need two types of Auth to function:</p>
<ol>
<li><strong>Login auth:</strong> This will likely be an pair of views providing an
   OAuth flow, where Balsam redirects the user to an external auth system,
   and upon successful authentication, user information is redirected <em>back</em>
   to a Balsam callback view. For testing purposes, basic password-based login
   could be used instead.</li>
<li><strong>Token auth:</strong> After the initial login, Balsam clients need a way to
   authenticate subsequent requests to the API.  This can be performed with
   Token authentication and a secure setup like <a href="https://github.com/James1345/django-rest-knox">Django REST
   Knox</a>.  Upon successful
   <em>login</em> authentication (step 1), a Token is generated and stored (encrypted)
   for the User.  This token is returned to the client in the login response.
   The client then stores this token, which has some expiration date, and
   includes it as a HTTP header on every subsequent request to the API (e.g.
   <code>Authorization: Token 4789ac8372...</code>). This is both how Javascript web clients and automated Balsam Site services can communicate with the API.</li>
</ol>
<h2 id="site">Site</h2>
<h3 id="model-fields">Model Fields</h3>
<table>
<thead>
<tr>
<th>Field Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Unique Site ID</td>
</tr>
<tr>
<td><code>hostname</code></td>
<td>The server address or hostname like <code>thetalogin3.theta.alcf.anl.gov</code></td>
</tr>
<tr>
<td><code>path</code></td>
<td>Absolute POSIX path to the Site directory</td>
</tr>
<tr>
<td><code>last_refresh</code></td>
<td>Automatically updated timestamp: last update to Site information</td>
</tr>
<tr>
<td><code>creation_date</code></td>
<td>Timestamp when Site was created</td>
</tr>
<tr>
<td><code>owner</code></td>
<td>ForeignKey to <code>User</code> model</td>
</tr>
<tr>
<td><code>globus_endpoint_id</code></td>
<td>Optional <code>UUID</code>: setting an associated endpoint for data transfer</td>
</tr>
<tr>
<td><code>num_nodes</code></td>
<td>Number of compute nodes available at the Site</td>
</tr>
<tr>
<td><code>num_idle_nodes</code></td>
<td>Number of currently idle nodes</td>
</tr>
<tr>
<td><code>num_busy_nodes</code></td>
<td>Number of currently busy nodes</td>
</tr>
<tr>
<td><code>backfill_windows</code></td>
<td>JSONField: array of <code>[queue, num_nodes, wall_time_min]</code> tuples indicating backfill slots</td>
</tr>
<tr>
<td><code>queued_jobs</code></td>
<td>JSONField: array of <code>[queue, num_nodes, wall_time_min, state]</code> indicating currently queued and running jobs</td>
</tr>
<tr>
<td><code>optional_batch_job_params</code></td>
<td>JSONField used in BatchJob forms/validation <code>{name: default_value}</code>. Taken from site config.</td>
</tr>
<tr>
<td><code>allowed_projects</code></td>
<td>JSONField used in BatchJob forms/validation: <code>[ name: str ]</code></td>
</tr>
<tr>
<td><code>allowed_queues</code></td>
<td>JSONField used in BatchJob forms/validation: <code>{name: {max_nodes, max_walltime, max_queued}}</code></td>
</tr>
<tr>
<td><code>transfer_locations</code></td>
<td>JSONField used in Job stage-in/stage-out validation: <code>{alias: {protocol, netloc}}</code></td>
</tr>
</tbody>
</table>
<h3 id="api">API</h3>
<h5 id="representation">Representation</h5>
<p>The <code>owner</code> field is excluded from the serialized representation.  Created sites
implicitly belong to the authenticated user, and a user can only view or update
sites that belong to them.</p>
<h5 id="urls">URLs</h5>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>URL</th>
<th>Description</th>
<th>Example usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/api/sites/</td>
<td>Retrieve the current user's list of sites</td>
<td>A user checks their Balsam site statuses on dashboard</td>
</tr>
<tr>
<td>POST</td>
<td>/api/sites/</td>
<td>Create a new Site</td>
<td><code>balsam init</code> creates a Site and stores new <code>id</code> locally</td>
</tr>
<tr>
<td>PUT</td>
<td>/api/sites/{id}</td>
<td>Update Site information</td>
<td>Service daemon syncs <code>backfill_windows</code> periodically</td>
</tr>
<tr>
<td>DELETE</td>
<td>/api/sites/{id}</td>
<td>Delete Site</td>
<td>User deletes their Site with <code>balsam rm site</code></td>
</tr>
</tbody>
</table>
<h2 id="app">App</h2>
<h3 id="model-fields_1">Model Fields</h3>
<table>
<thead>
<tr>
<th>Field Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Unique App ID</td>
</tr>
<tr>
<td><code>site</code></td>
<td>Foreign Key to <code>Site</code> instance containing this App</td>
</tr>
<tr>
<td><code>name</code></td>
<td>Short name identifying the app.</td>
</tr>
<tr>
<td><code>description</code></td>
<td>Text description (useful in generating Web forms)</td>
</tr>
<tr>
<td><code>class_path</code></td>
<td>Name of <code>ApplicationDefinition</code> class in the format: <code>{module_name}.{class_name}</code></td>
</tr>
<tr>
<td><code>parameters</code></td>
<td>Command line template parameters. A dict of dicts with the structure: <code>{name: {required: bool, default: str, help: str}}</code></td>
</tr>
<tr>
<td><code>transfers</code></td>
<td>A dict of stage-in/stage-out slots with the structure: <code>{name: {required: bool, direction: ["in"|"out"], target: str}}</code></td>
</tr>
</tbody>
</table>
<p>The <code>App</code> model is used to merely <em>index</em> the <code>ApplicationDefinition</code> classes
that a user has registered at their Balsam Sites. </p>
<p>The <code>parameters</code> field represents "slots" for each adjustable command line parameter.<br />
For example, an <code>ApplicationDefinition</code> command template of
<code>"echo hello, {{first_name}}!"</code> would result in an <code>App</code> having the <code>parameters</code> list: 
<code>[ {name: "first_name", required: true, default: "", help: ""} ]</code>.  None of the Balsam
site components use <code>App.parameters</code> internally; the purpose of mirroring this field in 
the database is simply to facilitate Job validation and create App-tailored web forms.</p>
<p>Similarly, <code>transfers</code>  mirrors data on the <code>ApplicationDefinition</code> for
Job input and validation purposes only.</p>
<p>For security reasons, the
validation of Job input parameters takes place in the site-local <code>ApplicationDefinition</code>
module. Even if a malicious user altered the <code>parameters</code> field in the API, they would not
be able to successfully run a Job with injected parameters.</p>
<h3 id="api_1">API</h3>
<h5 id="representation_1">Representation</h5>
<p>A user only sees Apps linked to Sites which belong to them.</p>
<h5 id="urls_1">URLs</h5>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>URL</th>
<th>Description</th>
<th>Example usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/api/apps/</td>
<td>Retrieve the current user's list of Apps</td>
<td><code>balsam ls apps</code> shows Apps across sites</td>
</tr>
<tr>
<td>POST</td>
<td>/api/apps/</td>
<td>Create a new <code>App</code></td>
<td><code>balsam app sync</code> creates new <code>Apps</code> from local <code>ApplicationDefinitions</code></td>
</tr>
<tr>
<td>PUT</td>
<td>/api/apps/{id}</td>
<td>Update <code>App</code> information</td>
<td><code>balsam app sync</code> updates existing <code>Apps</code> with changes from local <code>ApplicationDefinitions</code></td>
</tr>
<tr>
<td>DELETE</td>
<td>/api/apps/{id}</td>
<td>Delete <code>App</code></td>
<td>User deletes an <code>App</code>; all related <code>Jobs</code> are deleted</td>
</tr>
</tbody>
</table>
<h2 id="job">Job</h2>
<h3 id="model-fields_2">Model Fields</h3>
<table>
<thead>
<tr>
<th>Field Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Unique App ID</td>
</tr>
<tr>
<td><code>workdir</code></td>
<td>Working directory, <em>relative</em> to the Site <code>data/</code> directory</td>
</tr>
<tr>
<td><code>tags</code></td>
<td>JSON <code>{str: str}</code> mappings for tagging and selecting jobs</td>
</tr>
<tr>
<td><code>lock</code></td>
<td>ForeignKey to <code>Lock</code> instance</td>
</tr>
<tr>
<td><code>app</code></td>
<td>ForeignKey to <code>App</code> instance</td>
</tr>
<tr>
<td><code>parameters</code></td>
<td>JSON <code>{paramName: paramValue}</code> for the <code>App</code> command template parameters</td>
</tr>
<tr>
<td><code>batch_job</code></td>
<td>ForeignKey to current or most recent <code>BatchJob</code> instance in which this <code>Job</code> ran</td>
</tr>
<tr>
<td><code>state</code></td>
<td>Current state of the <code>Job</code></td>
</tr>
<tr>
<td><code>last_update</code></td>
<td>Timestamp of last modification to Job</td>
</tr>
<tr>
<td><code>data</code></td>
<td>Arbitrary JSON data storage</td>
</tr>
<tr>
<td><code>return_code</code></td>
<td>Most recent return code of job</td>
</tr>
<tr>
<td><code>parents</code></td>
<td>Non-symmetric ManyToMany  Parent --&gt; Child relations between Jobs</td>
</tr>
<tr>
<td><code>num_nodes</code></td>
<td>Number of compute nodes required (&gt; 1 implies MPI usage)</td>
</tr>
<tr>
<td><code>ranks_per_node</code></td>
<td>Number of ranks per node (&gt; 1 implies MPI usage)</td>
</tr>
<tr>
<td><code>threads_per_rank</code></td>
<td>Number of logical threads per MPI rank</td>
</tr>
<tr>
<td><code>threads_per_core</code></td>
<td>Number of logical threads per hardware core</td>
</tr>
<tr>
<td><code>cpu_affinity</code></td>
<td>Flag describing CPU affinity mode</td>
</tr>
<tr>
<td><code>gpus_per_rank</code></td>
<td>Number of GPUs per MPI rank</td>
</tr>
<tr>
<td><code>node_packing_count</code></td>
<td>Maximum number of instances that can run on a single node</td>
</tr>
<tr>
<td><code>wall_time_min</code></td>
<td>Lower bound estimate for runtime of the Job (leaving at default 0 is allowed)</td>
</tr>
</tbody>
</table>
<h3 id="api_2">API</h3>
<h5 id="representation_2">Representation</h5>
<p>A user can only access Jobs they own. The related App, BatchJob, and parents
are included by ID in the serialized representation. The <code>lock</code> is excluded
since it is only used internally.   Reverse relationships (one-to-many) with
<code>transfers</code> and <code>events</code> are also not included in the Job representation, as
they can be accessed through separate API endpoints.</p>
<p>The related entities are represented in JSON as follows:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Serialized</th>
<th>Deserialized</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>id</code></td>
<td>Primary Key</td>
<td>Fetch Job from user-filtered queryset</td>
</tr>
<tr>
<td><code>app_id</code></td>
<td>Primary Key</td>
<td>Fetch App from user-filtered queryset</td>
</tr>
<tr>
<td><code>batch_job_id</code></td>
<td>Primary Key</td>
<td>Fetch BatchJob from user-filtered queryset</td>
</tr>
<tr>
<td><code>parent_ids</code></td>
<td>Primary Key list</td>
<td>Fetch parent jobs from user-filtered queryset</td>
</tr>
<tr>
<td><code>transfers</code></td>
<td><strong>N/A</strong></td>
<td><em>Create only:</em> Dict of <code>{transfer_item_name: {location_alias: str, path: str}}</code></td>
</tr>
<tr>
<td><code>events</code></td>
<td><strong>N/A</strong></td>
<td><strong>N/A</strong></td>
</tr>
<tr>
<td><code>lock</code></td>
<td><strong>N/A</strong></td>
<td><strong>N/A</strong></td>
</tr>
</tbody>
</table>
<h5 id="urls_2">URLs</h5>
<p>Use cases:
-  Get paginated job list, sorted by <code>last_update</code>
-  List jobs filtered by: site, state, tags, BatchJob, app</p>
<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>URL</th>
<th>Description</th>
<th>Example usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>/api/jobs/</td>
<td>Retrieve the current user's list of Jobs</td>
<td></td>
</tr>
<tr>
<td>POST</td>
<td>/api/jobs/</td>
<td>Create a new <code>Job</code></td>
<td></td>
</tr>
<tr>
<td>PUT</td>
<td>/api/jobs/{id}</td>
<td>Update <code>Job</code> information</td>
<td></td>
</tr>
<tr>
<td>DELETE</td>
<td>/api/jobs/{id}</td>
<td>Delete <code>Job</code></td>
<td></td>
</tr>
</tbody>
</table>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../contributing/" title="Contribution Guide" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Contribution Guide
              </span>
            </div>
          </a>
        
        
          <a href="../site-config/" title="Site Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Site Configuration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/balsam-alcf" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../mermaid.min.js"></script>
      
    
  </body>
</html>