



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>The Python REST Client - Balsam</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#the-api-client" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Balsam" aria-label="Balsam" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Balsam
            </span>
            <span class="md-header-nav__topic">
              
                The Python REST Client
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/balsam-alcf/balsam/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    balsam-alcf/balsam
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Balsam" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Balsam
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/balsam-alcf/balsam/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    balsam-alcf/balsam
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../contributing/" title="Contribution Guide" class="md-nav__link">
      Contribution Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../data-model/" title="Data Model" class="md-nav__link">
      Data Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../site-config/" title="Site Configuration" class="md-nav__link">
      Site Configuration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        The Python REST Client
      </label>
    
    <a href="./" title="The Python REST Client" class="md-nav__link md-nav__link--active">
      The Python REST Client
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-restclient-interface" class="md-nav__link">
    The RESTClient interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-resource-components" class="md-nav__link">
    The Resource components
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../appdef/" title="Defining Applications" class="md-nav__link">
      Defining Applications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../jobsource/" title="JobSource and StatusUpdater" class="md-nav__link">
      JobSource and StatusUpdater
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../launcher/" title="Launcher" class="md-nav__link">
      Launcher
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../service/" title="Service modules" class="md-nav__link">
      Service modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../platform/" title="Platform Interfaces" class="md-nav__link">
      Platform Interfaces
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../todo/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/ffn_balsam_interactive/" title="Launching Jobs from a Jupyter Notebook" class="md-nav__link">
      Launching Jobs from a Jupyter Notebook
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../LICENSE/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-restclient-interface" class="md-nav__link">
    The RESTClient interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-resource-components" class="md-nav__link">
    The Resource components
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/balsam-alcf/balsam/edit/master/docs/development/client.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="the-api-client">The API Client</h1>
<p>In transitioning Balsam from a <strong>database-driven</strong> application to a multi-user, <strong>Web
client-driven</strong> application, we have had to rethink how the Python API
should look. Both internal Balsam components and user-written scripts need a way to 
manipulate and synchronize with the central state.</p>
<p>In Balsam <code>0.x</code>, users leverage direct access to the Django ORM and manipulate
the database with simple APIs like:
<code>BalsamJob.objects.filter(state="FAILED").delete()</code>.
Obviously, direct database access is not acceptable in a multi-user application.
However, in cutting off access to the Django ORM, users would lose the familiar API
(arguably one of Balsams' most important features) and have to drop down to writing
and decoding JSON data for each request.</p>
<p>The client architecure described below provides a solution to this problem with
a <em>Django ORM-inspired</em> API.  A familiar Python object model of the data,
complete with models (e.g. <code>Job</code>), managers (<code>Job.objects</code>), and Querysets
(<code>Job.objects.filter(state="FAILED").delete()</code>) is available. Instead of
accessing a database, execution of these "queries" results in a REST API call.</p>
<p>Internally, a <code>RESTClient</code> interface encapsulates the HTTP request and authentication logic and
contains <code>Resource</code> components that map ordinary Python methods to API methods.</p>
<p><img alt="Client Architecture" src="../../graphs/client.png" /></p>
<h2 id="the-restclient-interface">The <code>RESTClient</code> interface</h2>
<p>All Python interactions with the Balsam REST API occur through the
<code>balsam.client.RESTClient</code> interface.  The base <code>RESTClient</code> is a
composite class containing several <code>Resource</code> components that comprise the API's endpoints:</p>
<ol>
<li><code>users</code></li>
<li><code>sites</code></li>
<li><code>apps</code></li>
<li><code>batch_jobs</code></li>
<li><code>jobs</code></li>
<li><code>events</code></li>
<li><code>sessions</code></li>
</ol>
<p>In addition to these <code>Resources</code>, the RESTClient provides interfaces to 
perform the actual requests and authenticate to the API:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">RESTClient:</span>
    <span class="n">def</span> <span class="n">interactive_login</span>(<span class="k">self</span>):
        <span class="s">&quot;&quot;&quot;Initiate interactive login flow&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">refresh_auth</span>(<span class="k">self</span>):
        <span class="s">&quot;&quot;&quot;</span>
<span class="s">        Reload credentials if stored/not expired.</span>
<span class="s">        Set appropriate Auth headers on HTTP session.</span>
<span class="s">        &quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">request</span>(<span class="k">self</span>, <span class="n">absolute_url</span>, <span class="n">http_method</span>, <span class="n">payload</span>=<span class="n">None</span>):
        <span class="s">&quot;&quot;&quot;</span>
<span class="s">        Perform API request and return response data</span>
<span class="s">        Supports timeout retry, auto re-authentication, accepting DUPLICATE status</span>
<span class="s">        Raises helpful errors on 4**, 5**, TimeoutErrors, AuthErrors</span>
<span class="s">        &quot;&quot;&quot;</span>
</code></pre></div>

<p>Subclasses of the <code>RESTClient</code> interface are responsible for these
implementations. For instance, the <code>DirectAPIClient</code> makes a direct
connection to a PostgreSQL Balsam database and passes request objects
directly into the API views.  This permits users who wish to control 
their own Balsam database to do so without running an actual web server.</p>
<p>The <code>RequestsClient</code> uses the Python <code>requests</code> library to perform
real HTTPS requests. It supports sessions with persistent connections
and auto-retry of timed-out requests. Subclasses of <code>RequestsClient</code>
can override <code>refresh_auth()</code> and <code>interactive_login()</code> to support
different authentication schemes.</p>
<h2 id="the-resource-components">The <code>Resource</code> components</h2>
<p>The base <code>RESTClient</code> implementation contains 7 <code>Resource</code> components:
one for each path or logical resource in the API.
Each <code>Resource</code>, in turn, contains a set of API action
methods that build the URL and request payload, then invoke the
<code>RESTClient.request()</code> method to perform the communication. The
generic actions look as follows:</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="n">Resource:</span>
    <span class="n">def</span> <span class="n">list</span>(<span class="k">self</span>, **<span class="n">query_params</span>):
        <span class="s">&quot;&quot;&quot;Returns a collection of items matching query&quot;&quot;&quot;</span>
        <span class="n">url</span> = <span class="k">self</span>.<span class="n">client</span>.<span class="n">build_url</span>(<span class="k">self</span>.<span class="n">collection_path</span>, **<span class="n">query_params</span>)
        <span class="n">response</span> = <span class="k">self</span>.<span class="n">client</span>.<span class="n">request</span>(<span class="n">url</span>, <span class="s">&quot;GET&quot;</span>)
        <span class="k">return</span> <span class="k">self</span>.<span class="n">client</span>.<span class="n">extract_data</span>(<span class="n">response</span>)

    <span class="n">def</span> <span class="n">detail</span>(<span class="k">self</span>, <span class="n">uri</span>, **<span class="n">query_params</span>):
        <span class="s">&quot;&quot;&quot;Retrieve one object from collection&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">create</span>(<span class="k">self</span>, **<span class="n">payload</span>):
        <span class="s">&quot;&quot;&quot;Create new item; returns ID&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">update</span>(<span class="k">self</span>, <span class="n">uri</span>, <span class="n">payload</span>, <span class="n">partial</span>=<span class="nb">False</span>, **<span class="n">query_params</span>):
        <span class="s">&quot;&quot;&quot;Update an exisitng item&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">bulk_create</span>(<span class="k">self</span>, <span class="n">list_payload</span>):
        <span class="s">&quot;&quot;&quot;Bulk create list of items&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">bulk_update_query</span>(<span class="k">self</span>, <span class="n">patch</span>, **<span class="n">query_params</span>):
        <span class="s">&quot;&quot;&quot;Apply same patch to every item matched by query&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">bulk_update_patch</span>(<span class="k">self</span>, <span class="n">patch_list</span>):
        <span class="s">&quot;&quot;&quot;Applies a list of patches item-wise&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">destroy</span>(<span class="k">self</span>, <span class="n">uri</span>, **<span class="n">query_params</span>):
        <span class="s">&quot;&quot;&quot;Delete the item given by the uri&quot;&quot;&quot;</span>

    <span class="n">def</span> <span class="n">bulk_destroy</span>(<span class="k">self</span>, **<span class="n">query_params</span>):
        <span class="s">&quot;&quot;&quot;Delete the items matched by the query&quot;&quot;&quot;</span>
</code></pre></div>

<p>The <code>Resources</code> contain a circular reference back to their parent <code>RESTClient</code> to use the helper
methods <code>build_url</code> and <code>extract_data</code> as well as invoke <code>request</code>.  The uniform, flat structure
of the REST API allows the simple base <code>Resource</code> to be used for most API actions. For resources
with specialized API calls, <code>Resource</code> is be subclassed to provide the appropriate Python methods.</p>
<p>For example, <code>client.jobs</code> is a derived class named <code>JobResource</code> providing the additional method
<code>history()</code>, so that users may fetch all the events for a particular job via <code>client.jobs.history(uri)</code>.
A call to <code>client.jobs.history(3)</code> results in <code>HTTP GET</code> request to the path <code>jobs/3/events</code>.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../site-config/" title="Site Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Site Configuration
              </span>
            </div>
          </a>
        
        
          <a href="../appdef/" title="Defining Applications" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Defining Applications
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/balsam-alcf" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../mermaid.min.js"></script>
      
    
  </body>
</html>